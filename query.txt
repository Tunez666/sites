create table floor(
id_f int PRIMARY key AUTO_INCREMENT
)
create table dop_u(
id_dop int PRIMARY key AUTO_INCREMENT,
    name varchar(45),
    description varchar(45),
    price int
)
create table doljnost(
id_dol int PRIMARY key AUTO_INCREMENT,
    name varchar(45)
)
create table employees(
id_emp int PRIMARY key AUTO_INCREMENT,
    surname varchar(45),
    name varchar(45),
   lastname varchar(45),
    id_dol int,
    adres varchar(45),
    phone_num int,
    FOREIGN key (id_dol) REFERENCES doljnost(id_dol)  
)

create table type_a(
id_t int PRIMARY key AUTO_INCREMENT,
   name varchar(45),
    price int
)

create table apartments(
id_apart int PRIMARY key AUTO_INCREMENT,
    id_f int,
    status varchar(45),
    cleaning varchar(45),
    id_t int,
id_ubor int,
    FOREIGN key (id_f) REFERENCES floor(id_f), 
    FOREIGN key (id_t) REFERENCES type_a(id_t),  
    FOREIGN key (id_ubor) REFERENCES employees(id_emp)
)

create table guests(
id_g int PRIMARY key AUTO_INCREMENT,
   surname varchar(45),  
    name varchar(45),
    lastname varchar(45),
    date_b date,
    seria_p int,
    num_p int,
    kem_vyd varchar(45),
    address varchar(45),
    num_t int,
    srok_proz int,
    id_apart int,
    pribyl date,
    vybyl date,
    num_auto varchar(45),
    prodlenie varchar(45),
    id_dop int,
    id_emp int,
    FOREIGN key (id_apart) REFERENCES apartments(id_apart),
     FOREIGN key (id_dop) REFERENCES dop_u(id_dop),
     FOREIGN key (id_emp) REFERENCES employees(id_emp)
)

-- Вставка типов апартаментов в таблицу yuf_type_a
INSERT INTO type_a (id_t, name, price) VALUES 
(1, 'Одноместный стандарт', 12600),
(2, 'Одноместный эконом', 10000),
(3, 'Стандарт двухместный с 2 раздельными кроватями', 21500),
(4, 'Эконом двухместный с 2 раздельными кроватями', 16000),
(5, '3-местный бюджет', 15000),
(6, 'Бизнес с 1 или 2 кроватями', 20000),
(7, 'Двухкомнатный двухместный стандарт с 1 или 2 кроватями', 25000),
(8, 'Студия', 16000),
(9, 'Люкс с 2 двуспальными кроватями', 50000)

-- Вставка апартаментов для 1 этажа
INSERT INTO apartments (id_apart, id_f, id_t, status) VALUES
(101, 1, (SELECT id_t FROM type_a WHERE name = 'Одноместный стандарт'), 'Занят'),
(102, 1, (SELECT id_t FROM type_a WHERE name = 'Одноместный стандарт'), 'Занят'),
(103, 1, (SELECT id_t FROM type_a WHERE name = 'Одноместный эконом'), 'Чистый'),
(104, 1, (SELECT id_t FROM type_a WHERE name = 'Одноместный эконом'), 'Занят'),
(105, 1, (SELECT id_t FROM type_a WHERE name = 'Стандарт двухместный с 2 раздельными кроватями'), 'Занят'),
(106, 1, (SELECT id_t FROM type_a WHERE name = 'Стандарт двухместный с 2 раздельными кроватями'), 'Чистый'),
(107, 1, (SELECT id_t FROM type_a WHERE name = 'Эконом двухместный с 2 раздельными кроватями'), 'Занят'),
(108, 1, (SELECT id_t FROM type_a WHERE name = 'Эконом двухместный с 2 раздельными кроватями'), 'Занят'),
(109, 1, (SELECT id_t FROM type_a WHERE name = '3-местный бюджет'), 'Занят'),
(110, 1, (SELECT id_t FROM type_a WHERE name = '3-местный бюджет'), 'Занят');

-- Вставка апартаментов для 2 этажа
INSERT INTO apartments (id_apart, id_f, id_t, status) VALUES
(201, 2, (SELECT id_t FROM type_a WHERE name = 'Бизнес с 1 или 2 кроватями'), 'Занят'),
(202, 2, (SELECT id_t FROM type_a WHERE name = 'Бизнес с 1 или 2 кроватями'), 'Чистый'),
(203, 2, (SELECT id_t FROM type_a WHERE name = 'Бизнес с 1 или 2 кроватями'), 'Занят'),
(204, 2, (SELECT id_t FROM type_a WHERE name = 'Двухкомнатный двухместный стандарт с 1 или 2 кроватями'), 'Назначен к уборке'),
(205, 2, (SELECT id_t FROM type_a WHERE name = 'Двухкомнатный двухместный стандарт с 1 или 2 кроватями'), 'Занят'),
(206, 2, (SELECT id_t FROM type_a WHERE name = 'Двухкомнатный двухместный стандарт с 1 или 2 кроватями'), 'Занят'),
(207, 2, (SELECT id_t FROM type_a WHERE name = 'Одноместный стандарт'), 'Занят'),
(208, 2, (SELECT id_t FROM type_a WHERE name = 'Одноместный стандарт'), 'Занят'),
(209, 2, (SELECT id_t FROM type_a WHERE name = 'Одноместный стандарт'), 'Занят');

-- Вставка апартаментов для 3 этажа
INSERT INTO apartments (id_apart, id_f, id_t, status) VALUES
(301, 3, (SELECT id_t FROM type_a WHERE name = 'Студия'), 'Грязный'),
(302, 3, (SELECT id_t FROM type_a WHERE name = 'Студия'), 'Грязный'),
(303, 3, (SELECT id_t FROM type_a WHERE name = 'Студия'), 'Чистый'),
(304, 3, (SELECT id_t FROM type_a WHERE name = 'Люкс с 2 двуспальными кроватями'), 'Занят'),
(305, 3, (SELECT id_t FROM type_a WHERE name = 'Люкс с 2 двуспальными кроватями'), 'Чистый'),
(306, 3, (SELECT id_t FROM type_a WHERE name = 'Люкс с 2 двуспальными кроватями'), 'Занят');

UPDATE apartments 
SET id_t = 3 
WHERE id_apart IN (105, 106);

UPDATE apartments 
SET id_t = 7 
WHERE id_apart IN (204, 205, 206);

insert into doljnost(name) VALUES
('Горничная'),
('Руководитель'),
('Администратор')

INSERT INTO employees (surname, name, lastname, id_dol, adres, phone_num) VALUES
-- Горничные
('Батурина', 'Ольга', 'Николаевна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Ленина 15-42', '79001234567'),
('Иванова', 'Нина', 'Юрьевна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Пушкина 23-12', '79002345678'),
('Толчеева', 'Екатерина', 'Васильевна',(SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Гагарина 7-15', '79003456789'),
('Покрышкина', 'Наталья', 'Юрьевна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Мира 45-78', '79004567890'),
('Поренкова', 'Наталья', 'Сергеевна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Советская 12-34', '79005678901'),
('Григорьева', 'Любовь', 'Петровна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Космонавтов 89-12', '79006789012'),
('Круглова', 'Светлана', 'Леонидовна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Строителей 56-78', '79007890123'),
('Сидорова', 'Надежда', 'Петровна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Победы 34-56', '79008901234'),
('Балабанова', 'Наталья', 'Игнатьевна', (SELECT id_dol FROM doljnost WHERE name = 'Горничная'), 'ул. Комсомольская 67-89', '79009012345'),

-- Руководители
('Петров', 'Александр', 'Иванович', (SELECT id_dol FROM doljnost WHERE name = 'Руководитель'), 'ул. Центральная 1-123', '79010123456'),
('Смирнова', 'Елена', 'Владимировна', (SELECT id_dol FROM doljnost WHERE name = 'Руководитель'), 'ул. Московская 45-67', '79011234567'),

-- Администраторы
('Козлова', 'Мария', 'Александровна', (SELECT id_dol FROM doljnost WHERE name = 'Администратор'), 'ул. Парковая 78-90', '79012345678'),
('Морозов', 'Дмитрий', 'Сергеевич', (SELECT id_dol FROM doljnost WHERE name = 'Администратор'), 'ул. Садовая 23-45', '79013456789');

INSERT INTO yuf_dop_u (id_dop, name, description, price) VALUES
(1, 'Дополнительный завтрак', 'Шведский стол с европейской кухней', 750),
(2, 'Дополнительный ужин', 'Ужин по системе шведский стол', 1100),
(3, 'Зал для конференций (большой)', 'Большой зал с подиумом, рассадка-театр', 5500),
(4, 'Зал для конференций (малый)', 'Малый зал с мобильной мебелью до 25 человек', 3500),
(5, 'Бизнес центр', 'Аренда компьютера, сканер, принтер', 400),
(6, 'Прачечная', 'Стирка, сушка, глажка с доставкой в номер', NULL),
(7, 'Банкетный зал', 'Организация кофе-пауз и фуршетов', 2500),
(8, 'Тренажерный зал', 'Бесплатно для проживающих в гостинице', NULL),
(9, 'Парковка', 'Охраняемая парковка у центрального входа', 750),
(10, 'Камера хранения', 'Круглосуточная камера хранения', 50);

-- Добавление поля summ в таблицу гостей (если его еще нет)
ALTER TABLE guests ADD COLUMN IF NOT EXISTS summ DECIMAL(10,2);

-- Вставка данных в таблицу гостей с администраторами и доп. услугами
INSERT INTO guests (
    surname, name, lastname, 
    date_b, seria_p, num_p, 
    kem_vyd, address, num_t, 
    srok_proz, id_apart, 
    pribyl, vybyl, 
    num_auto, prodlenie,
    id_dop, id_emp
) VALUES
-- 1 этаж
('Шевченко', 'Ольга', 'Викторовна', 
 '1985-06-15', '4510', '123456', 
 'УМВД России по г. Москве', 'г. Москва, ул. Ленина 45-12', '79001234567',
 7, 101, 
 '2024-03-10', '2024-03-17',
 NULL, NULL,
 1, 12),  -- Доп. завтрак, администратор Козлова

('Мазалова', 'Ирина', 'Львовна',
 '1978-03-22', '4511', '234567',
 'УМВД России по г. Санкт-Петербургу', 'г. Санкт-Петербург, пр. Невский 78-45', '79002345678',
 5, 102,
 '2024-03-11', '2024-03-16',
 'А123ВС178', NULL,
 2, 13),  -- Доп. ужин, администратор Морозов

('Семеняка', 'Юрий', 'Геннадьевич',
 '1990-11-30', '4512', '345678',
 'УМВД России по г. Екатеринбургу', 'г. Екатеринбург, ул. Мира 15-67', '79003456789',
 3, 104,
 '2024-03-12', '2024-03-15',
 NULL, NULL,
 5, 12),  -- Бизнес центр, администратор Козлова

('Савельев', 'Олег', 'Иванович',
 '1982-08-25', '4513', '456789',
 'УМВД России по г. Новосибирску', 'г. Новосибирск, ул. Гагарина 34-89', '79004567890',
 4, 105,
 '2024-03-11', '2024-03-15',
 'В456АМ54', NULL,
 9, 13),  -- Парковка, администратор Морозов

('Бунин', 'Эдуард', 'Михайлович',
 '1975-04-18', '4514', '567890',
 'УМВД России по г. Казани', 'г. Казань, ул. Пушкина 56-23', '79005678901',
 6, 107,
 '2024-03-09', '2024-03-15',
 NULL, NULL,
 3, 12),  -- Зал для конференций (большой), администратор Козлова

('Бахшиев', 'Павел', 'Иннокентьевич',
 '1988-09-12', '4515', '678901',
 'УМВД России по г. Краснодару', 'г. Краснодар, ул. Красная 89-34', '79006789012',
 6, 107,
 '2024-03-09', '2024-03-15',
 NULL, NULL,
 NULL, 13),  -- Без доп. услуг, администратор Морозов

('Тюренкова', 'Наталья', 'Сергеевна',
 '1992-07-03', '4516', '789012',
 'УМВД России по г. Ростову', 'г. Ростов, ул. Садовая 23-78', '79007890123',
 5, 108,
 '2024-03-10', '2024-03-15',
 NULL, NULL,
 1, 12),  -- Доп. завтрак, администратор Козлова

('Любяшева', 'Галина', 'Аркадьевна',
 '1980-12-28', '4517', '890123',
 'УМВД России по г. Волгограду', 'г. Волгоград, пр. Ленина 67-45', '79008901234',
 4, 109,
 '2024-03-11', '2024-03-15',
 NULL, NULL,
 2, 13),  -- Доп. ужин, администратор Морозов

('Александров', 'Петр', 'Константинович',
 '1973-02-14', '4518', '901234',
 'УМВД России по г. Самаре', 'г. Самара, ул. Молодогвардейская 45-12', '79009012345',
 4, 110,
 '2024-03-11', '2024-03-15',
 NULL, NULL,
 9, 12),  -- Парковка, администратор Козлова

-- 2 этаж
('Мазалова', 'Ольга', 'Николаевна',
 '1983-05-20', '4519', '012345',
 'УМВД России по г. Нижнему Новгороду', 'г. Нижний Новгород, ул. Минина 34-56', '79010123456',
 7, 201,
 '2024-03-09', '2024-03-16',
 'Е789КМ152', NULL,
 5, 13),  -- Бизнес центр, администратор Морозов

('Лапшин', 'Виктор', 'Романович',
 '1970-10-08', '4520', '123789',
 'УМВД России по г. Челябинску', 'г. Челябинск, пр. Победы 78-90', '79011234567',
 5, 203,
 '2024-03-10', '2024-03-15',
 NULL, NULL,
 7, 12),  -- Банкетный зал, администратор Козлова

('Гусев', 'Семен', 'Петрович',
 '1985-11-15', '4521', '234890',
 'УМВД России по г. Омску', 'г. Омск, ул. Маршала Жукова 56-78', '79012345678',
 6, 205,
 '2024-03-09', '2024-03-15',
 'К123ЕН55', NULL,
 9, 13),  -- Парковка, администратор Морозов

('Гладилина', 'Вера', 'Михайловна',
 '1989-03-25', '4522', '345901',
 'УМВД России по г. Уфе', 'г. Уфа, ул. Ленина 23-45', '79013456789',
 4, 206,
 '2024-03-11', '2024-03-15',
 NULL, NULL,
 1, 12),  -- Доп. завтрак, администратор Козлова

('Масюк', 'Динара', 'Викторовна',
 '1995-08-30', '4523', '456012',
 'УМВД России по г. Красноярску', 'г. Красноярск, пр. Мира 89-12', '79014567890',
 5, 207,
 '2024-03-10', '2024-03-15',
 NULL, NULL,
 2, 13),  -- Доп. ужин, администратор Морозов

('Лукин', 'Илья', 'Федорович',
 '1977-06-17', '4524', '567123',
 'УМВД России по г. Воронежу', 'г. Воронеж, ул. Кирова 45-67', '79015678901',
 3, 208,
 '2024-03-12', '2024-03-15',
 'М456АВ36', NULL,
 4, 12),  -- Зал для конференций (малый), администратор Козлова

('Петров', 'Станислав', 'Игоревич',
 '1987-09-05', '4525', '678234',
 'УМВД России по г. Перми', 'г. Пермь, ул. Сибирская 78-34', '79016789012',
 4, 209,
 '2024-03-11', '2024-03-15',
 NULL, NULL,
 10, 13),  -- Камера хранения, администратор Морозов

-- 3 этаж
('Филь', 'Марина', 'Федоровна',
 '1981-04-12', '4526', '789345',
 'УМВД России по г. Тюмени', 'г. Тюмень, ул. Республики 56-89', '79017890123',
 7, 304,
 '2024-03-09', '2024-03-16',
 NULL, NULL,
 1, 12),  -- Доп. завтрак, администратор Козлова

('Михайлов', 'Игорь', 'Вадимович',
 '1976-12-03', '4527', '890456',
 'УМВД России по г. Иркутску', 'г. Иркутск, ул. Ленина 34-78', '79018901234',
 5, 306,
 '2024-03-10', '2024-03-15',
 'Р789СТ38', NULL,
 9, 13);  -- Парковка, администратор Морозов

-- Обновление поля summ для расчета общей суммы
UPDATE guests g
SET summ = (
    SELECT (t.price * g.srok_proz) + COALESCE(d.price, 0)
    FROM apartments a
    JOIN type_a t ON a.id_t = t.id_t
    LEFT JOIN dop_u d ON g.id_dop = d.id_dop
    WHERE a.id_apart = g.id_apart
);























